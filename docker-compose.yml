services:
  postgres:
    image: postgres:18
    container_name: auth_db
    restart: unless-stopped
    ports:
      - "5432:5432"
    environment:
      POSTGRES_DB: ${DB_NAME:-authdb}
      POSTGRES_USER: ${DB_USER:-admin}
      POSTGRES_PASSWORD: ${DB_PASSWORD:-strongpassword}
      POSTGRES_INITDB_ARGS: "--encoding=UTF8 --locale=C"
    volumes:
      - postgres_data:/var/lib/postgresql
      # - ./init-scripts:/docker-entrypoint-initdb.d  # 可选：初始化脚本目录
    healthcheck:
      # 增加 -d 参数，显式指定连接 authdb 数据库
      test: ["CMD-SHELL", "pg_isready -U ${POSTGRES_USER:-admin} -d ${POSTGRES_DB:-authdb}"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - postgres-network
    # 可选：如果需要外部访问指定IP
    # network_mode: "host"  # 使用主机网络模式，注意这会暴露所有端口

volumes:
  postgres_data:
    name: postgres-18-authdb

networks:
  postgres-network:
    driver: bridge